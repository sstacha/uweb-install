# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# http://wiki.nginx.org/Pitfalls
# http://wiki.nginx.org/QuickStart
# http://wiki.nginx.org/Configuration
#
# Generally, you will want to move this file somewhere, and start with a clean
# file but keep this around for reference. Or just disable in sites-enabled.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#

# NOTE: uncomment this block to force http to https
#server {
#    listen 80 default_server;
#    listen [::]:80 default_server;
#    server_name _;
#    return 301 https://www.ubercode.io$request_uri;
#}

server {
    # NOTE: comment these when setting up SSL Https instead
    listen 80 default_server;
    listen [::]:80 default_server;
    # use these instead for a virtual server
    # listen 80;
    # listen [::]:80;

    # SSL configuration
    #
    # listen 443 ssl default_server;
    # listen [::]:443 ssl default_server;
    #
    # Note: You should disable gzip for SSL traffic.
    # See: https://bugs.debian.org/773332
    #
    # Read up on ssl_ciphers to ensure a secure configuration.
    # See: https://bugs.debian.org/765782
    #
    # Self signed certs generated by the ssl-cert package
    # Don't use them in a production server!
    #
    # include snippets/snakeoil.conf;
    # NOTE: uncomment these common settings and adjust for your domain for common https options
    # ssl on;
    # ssl_certificate /etc/ssl/certs/<yourdomain>/<yourdomain>.crt;
    # ssl_certificate_key /etc/ssl/certs/<yourdomain>/<yourdomain>.key;
    # ssl_session_timeout 1d;
    # ssl_session_cache shared:SSL:20m;
    # ssl_session_tickets off;

    # root /var/www/html;
    root /home/uweb/website;

    # Add index.php to the list if you are using PHP
    index index.html index.htm index.nginx-debian.html;

    server_name _;
    # use this instead of _ for an example site instead of a default one (virtual domain)
    # server_name example.com;

    # return forbidden for any php, asp, jsp, our .dt templates, or myadmin requests
    location ~ (\.dt$|myadmin|\.php$|\.jsp$|\.asmx$|\.asp$) {
	    deny all;
    }

    # Django media
    location /media  {
        alias /home/uweb/website/media;
    }
    # django static
    location /static {
        alias /home/uweb/website/static;
    }

    # the rest of the cache, images and docroot files
    location / {
    index index.html index.htm index.nginx-debian.html;
    # First attempt to serve request as file, then
    # as directory, then fall back to sending to django.
    # NOTE: this means django handles 404's
    # index index.html index.htm;
    try_files   /cache$uri
                /cache/$uri
                /cache/$uri/index.html
                /images$uri
                /images/$uri
                /docroot$uri
                /docroot/$uri
                /docroot/$uri/index.html @django;

    }
    location @django {
        include         proxy_params;
        proxy_pass      http://unix:/home/uweb/website/uweb.sock;
    }
}